---
:parameters:
  - 
    :name: "Terminology"
    :description: "The terminology for which the submission impact is required."
    :type: :thesauri
:columns:
  :sl:
    :label: Sponsor Code List Label
    :type: literal
  :sclil:
    :label: Sponsor Code List Item Label
    :type: literal
  :si:
    :label: Sponsor Identifier
    :type: literal
  :sn:
    :label: Sponsor Notation
    :type: literal
  :cll:
    :label: CDISC Code List Label
    :type: literal
  :clil:
    :label: CDISC Code List Item Label
    :type: literal
  :i:
    :label: CDISC Identifier
    :type: literal
  :n:
    :label: CDISC Notation
    :type: literal
  :ctv:
    :label: CDISC Version
    :type: literal
  :t:
    :label: Type
    :type: literal
:label: Submission Impact Export
:query: 'PREFIX isoI: <http://www.assero.co.uk/ISO11179Identification#>  
PREFIX isoR: <http://www.assero.co.uk/ISO11179Registration#>  
PREFIX isoC: <http://www.assero.co.uk/ISO11179Concepts#>  
PREFIX isoT: <http://www.assero.co.uk/ISO11179Types#> 
SELECT DISTINCT ?sl ?sclil ?si ?sn ?cll ?clil ?i ?n ?ctv ?t  WHERE        
{           
  VALUES ?th {[[[parameter_1]]]}     
  { 
    {       
      SELECT DISTINCT ?ct ?ctv WHERE          
      {               
        ?ct rdf:type th:Thesaurus .           
        ?ct isoT:hasIdentifier/isoI:version ?ctv.                      
        ?th th:reference/bo:reference ?refct .       
        ?refct isoT:hasIdentifier/isoI:version ?v.           
        FILTER (?ctv > ?v )           
      }           
    }     
    {           
      ?th (th:isTopConceptReference/bo:reference) ?scl .
      FILTER (NOT EXISTS { ?scl isoT:hasState/isoR:byAuthority/isoR:owner ?o .
                   FILTER (?o = false ) } 
           && EXISTS { ?scl isoT:hasState/isoR:byAuthority/isoR:owner ?o .
                 FILTER (?o = true ) } )       
      ?scl th:notation ?sn .          
      ?ct (th:isTopConceptReference/bo:reference) ?cl .
      ?cl th:notation ?n .          
      FILTER (?sn = ?n) 
      ?cl isoC:label ?cll . 
      ?cl th:identifier ?i .
      ?scl isoC:label ?sl .
      ?scl th:identifier ?si .
      BIND ("Code List" as ?t)          
    } UNION       
    {         
      ?th th:isTopConceptReference/bo:reference ?scl .
      ?scl  th:narrower ?scli .
      FILTER (NOT EXISTS { ?scli ^th:narrower/isoT:hasState/isoR:byAuthority/isoR:owner ?o .
                   FILTER (?o = false ) } 
           && EXISTS { ?scli ^th:narrower/isoT:hasState/isoR:byAuthority/isoR:owner ?o .
                 FILTER (?o = true ) } )        
      ?scli th:notation ?sn .           
      ?ct th:isTopConceptReference/bo:reference/th:narrower ?cli .
      ?cli th:notation ?n .       
      FILTER (?sn = ?n)
      ?cli isoC:label ?clil .
      ?cli th:identifier ?i .
      ?scli isoC:label ?sclil .
      ?scli th:identifier ?si . 
      BIND ("Code List Item" as ?t)             
    }       
  } 
}'
:type: Ad Hoc Report Definition