---
:parameters:
  - 
    :name: "Terminology"
    :description: "The terminology for which the change instructions are required."
    :type: :thesauri
:columns:
  :pid:
    :label: CL Code
  :pnot:
    :label: CL Submission Value
  :rpi:
    :label: Previous Reference Identifier
  :rpsv:
    :label: Previous Reference Submission Value
  :rpv:
    :label: Previous Reference Version
  :pident:
    :label: CL Code
  :pnotat:
    :label: CL Submission Value
  :rci:
    :label: Current Reference Identifier
  :rcsv:
    :label: Current Reference Submission Value
  :rcv:
    :label: Current Reference Version
  :reference:
    :label: Reference
  :description:
    :label: Description
:label: Change Instructions Export
:query: 'PREFIX ba: <http://www.assero.co.uk/Annotations#>
PREFIX th: <http://www.assero.co.uk/Thesaurus#>
PREFIX isoI: <http://www.assero.co.uk/ISO11179Identification#> 
PREFIX isoR: <http://www.assero.co.uk/ISO11179Registration#> 
PREFIX isoC: <http://www.assero.co.uk/ISO11179Concepts#> 
PREFIX isoT: <http://www.assero.co.uk/ISO11179Types#> 
PREFIX bo: <http://www.assero.co.uk/BusinessOperational#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
PREFIX skos: <http://www.w3.org/2004/02/skos/core#> 
PREFIX is: <http://purl.org/ontology/is/core#>
PREFIX iso: <http://purl.org/iso25964/skos-thes#>
SELECT DISTINCT ?pid ?pnot ?rpi ?rpsv ?rpv ?pident ?pnotat ?rci ?rcsv ?rcv ?reference ?description WHERE       
{
  VALUES ?th {[[[parameter_1]]]}
  {
      OPTIONAL{?ci (ba:current/bo:context) ?th .}
      OPTIONAL{?ci (ba:previous/bo:context) ?th .}  
      ?ci rdf:type ba:ChangeInstruction .
      ?ci ba:reference ?reference .
      ?ci ba:description ?description .
      ?ci ba:previous ?previous .
      ?previous bo:reference ?pr .
      ?pr th:identifier ?rpi .
      ?pr th:notation ?rpsv .
      OPTIONAL 
      {             
        ?pr rdf:type th:ManagedConcept .               
        ?pr isoT:hasIdentifier/isoI:version ?rpv.
        BIND (" " as ?pid)
        BIND (" " as ?pnot)
      }           
      OPTIONAL 
      {
        ?pr rdf:type th:UnmanagedConcept . 
        ?ci (ba:previous/bo:context) ?term .
        ?pr ^th:narrower ?parent .
        ?term th:isTopConceptReference/bo:reference ?parent .                                                
        ?parent isoT:hasIdentifier/isoI:version ?rpv.
        ?parent th:identifier ?pid .
        ?parent th:notation ?pnot .

      }
      ?ci ba:current ?current .
      ?current bo:reference ?cr .
      ?cr th:identifier ?rci .
      ?cr th:notation ?rcsv .
      OPTIONAL 
      {             
        ?cr rdf:type th:ManagedConcept .               
        ?cr isoT:hasIdentifier/isoI:version ?rcv .
        BIND (" " as ?pident)
        BIND (" " as ?pnotat)
      }           
      OPTIONAL 
      {
        ?cr rdf:type th:UnmanagedConcept . 
        ?ci (ba:current/bo:context) ?term2 .
        ?cr ^th:narrower ?parent2 .
        ?term2 th:isTopConceptReference/bo:reference ?parent2 .                                      
        ?parent2 isoT:hasIdentifier/isoI:version ?rcv.
        ?parent2 th:identifier ?pident .
        ?parent2 th:notation ?pnotat .
      }
  } 
}'
:type: Ad Hoc Report Definition