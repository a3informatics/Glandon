/*
* CDISC Version Select Modal
*
* Requires:
* #cdisc-select-modal [Partial]
*/

/**
 * CDISC Version Select Modal Constructor
 *
 * @param callback [Function] Version selected callback
 * @param description [String] Type of textÂ description in the modal, if null, will remain default
 * @return [void]
 */
function CdiscVersionSelect(callback, description) {
  this.callback = callback;
  this.id = "#cdisc-select-modal";
  this.init();

  if(description != null)
    $(this.id + " #tl-slider-title").html(this.descriptions(description));

  return this;
}


/**
 * Load data from server to the table
 *
 * @return [void]
 */
CdiscVersionSelect.prototype.init = function () {
  this.ts = new TimelineSlider($(this.id + " .timeline-container"), $(this.id + " #timeline-start-btn"), null, $(this.id + " .timeline-point"));

  $(this.id).off('shown.bs.modal').on('shown.bs.modal', function () {
    this.ts.moveToDate(this.ts.l_slider, latestCDISCVer);
  }.bind(this));


  $("#select-cdisc-ter-btn").off("click").on("click", function() {
    var selectedPoint = $(this.id + " .timeline-point.point-highlight span");
    var selectedDate = Date.parse(selectedPoint.text());
    var selectedId = selectedPoint.attr("data-index");

    this.callback(selectedDate, selectedId);
  }.bind(this));
}

CdiscVersionSelect.prototype.open = function () {
  $(this.id).modal('show');
}


CdiscVersionSelect.prototype.descriptions = function (name) {
  var descriptionsMap = {
    impact: "To continue, choose a CDISC Terminology version to perform Impact Analysis on and click Select. <br/> The version must be newer than the one this Thesaurus is using."
  }

  return descriptionsMap[name];
}
