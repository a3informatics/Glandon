<%= javascript_tag 'setPageTitle("Background jobs")' %>
<%= javascript_include_tag 'backgrounds/index', 'standard_datatable'%>
<%= stylesheet_link_tag 'shared/datatables_loading' %>
<% first_level_breadcrumb (:backgrounds) %>

<div class="row">
	<%= render layout: "shared/simple_header_card_general", :locals => {badge: "icon-jobs", header_title: "",
		main_text: "Background Jobs", sub_texts: "List of active and past background jobs." } do %>
	<% end %>
</div>

<div class="row">
	<div class="col-md-12 card wide">
		<div class="card-header">
			Index: Background Jobs
		</div>
		<div class="card-content table-cardstyle" style="overflow: visible;">
			<table id="main" class="table table-striped table-bordered table-condensed">
				<thead>
			  	<tr>
			    	<th>Description</th>
			    	<th>Status</th>
			    	<th>Started At</th>
			    	<th class="fit">% Complete</th>
			    	<th class="fit">Complete</th>
			    	<th>Completed At</th>
		        <th class="fit"></th>
			  	</tr>
				</thead>
				<tbody>
					<% @jobs.each do |job| %>
			    	<tr>
							<td><%= job.description.presence || "No description." %></td>
			    		<td>
								<%if (job.status.presence || "").length < 120 %>
									<%= job.status %>
								<% else %>
								  <%= job.status[0..120].concat('...') %>
									<span class="icon-view ttip"> <span class="font-light">Hold mouse to see details</span> <span class="ttip-text wrap shadow-small text-medium text-small"><%= job.status %></span></span>
								<% end %>
							</td>
			    		<td><%= Timestamp.new(job.started).to_datetime %></td>
			    		<td class="text-center"><%= job.percentage %></td>
			    		<%= true_false_glyphicon(job.complete) %>
			    		<td><%= Timestamp.new(job.completed).to_datetime %></td>
		          <td>
								<button class="btn red btn-xs" id="delete_button_<%=job.id%>"
										onclick="new ConfirmationDialog(function(){$('#delete_link_<%=job.id%>').click()}, {dangerous: true}).show();">
									Delete
								</button>
								<%= link_to "", background_path(job), method: :delete, id: "delete_link_#{job.id}" %>
		          </td>
			    	</tr>
					<% end %>
			  </tbody>
			</table>
			<button class="btn red medium" id="delete_completed_button"
					onclick="new ConfirmationDialog(function(){$('#delete_link_completed').click()}, {dangerous: true}).show();">
				<span class="icon-trash"></span> Delete Completed
			</button>
			<%= link_to "", destroy_multiple_backgrounds_path({backgrounds: {items: "completed"}}), method: :delete, id: "delete_link_completed" %>

			<button class="btn red medium" id="delete_all_button"
					onclick="new ConfirmationDialog(function(){$('#delete_link_all').click()}, {dangerous: true}).show();">
				<span class="icon-trash"></span> Delete All
			</button>
			<%= link_to "", destroy_multiple_backgrounds_path({backgrounds: {items: "all"}}), method: :delete, id: "delete_link_all" %>
		</div>
	</div>
</div>
