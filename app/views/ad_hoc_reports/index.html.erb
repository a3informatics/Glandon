<%= javascript_tag 'setPageTitle("Ad-Hoc Reports")' %>
<%= javascript_include_tag 'standard_datatable' %>
<% first_level_breadcrumb (:ad_hoc_reports) %>

<div class="row">
	<%= render layout: "shared/simple_header_card_general", :locals => {badge: "icon-document", header_title: "",
		main_text: "Ad-Hoc Reports", sub_texts: "View, manage and run your Ad-Hoc reports." } do %>

		<%= render partial: "shared/buttons/ico_btn_secondary", :locals => {link_path: "javascript: history.back()", id: "close",
			icon: "icon-long-arrow", btn_text: "Return", dt_toggle: "", disabled: false } %>

	<% end %>
</div>

<div class="row centered">
	<div class="col-md-10 card wide">
		<div class="card-header">Index: Ad-Hoc Reports</div>
		<div class="card-content table-cardstyle">
			<table id="main" class="table table-striped table-bordered table-condensed">
				<thead>
			  	<tr>
			    	<th>Label</th>
			    	<th>Last Run</th>
			    	<th class="fit">Active</th>
			    	<th class="fit ignore"></th>
			    	<th class="fit ignore"></th>
			    	<th class="fit ignore"></th>
			  	</tr>
				</thead>
				<tbody>
					<% @items.each do |item| %>
			    	<tr>
							<td><%= item.label %></td>
			    		<td><%= Timestamp.new(item.last_run).to_datetime %></td>
			    		<%= true_false_glyphicon(item.active) %>
			    		<td><%= link_to "Run", run_start_ad_hoc_report_path(item), :class => "btn green btn-xs" %></td>
			    		<td><%= link_to "Results", results_ad_hoc_report_path(item), :class => "btn btn-xs" %></td>
							<td>
				    		<% if policy(AdHocReport).destroy? %>
									<button class="btn red btn-xs" id="delete_button_<%=item.id%>"
											onclick="new ConfirmationDialog(function(){$('#delete_link_<%=item.id%>').click()}, {dangerous: true}).show();">
										Delete
									</button>
									<%= link_to "", ad_hoc_report_path(item), method: :delete, id: "delete_link_#{item.id}" %>
				    		<% end %>
			    		</td>
			    	</tr>
					<% end %>
			  </tbody>
			</table>
			<% if policy(AdHocReport).create? %>
				<%= link_to "+ Add New", new_ad_hoc_report_path, :class => "btn medium green" %>
			<% end %>
		</div>
	</div>
</div>
