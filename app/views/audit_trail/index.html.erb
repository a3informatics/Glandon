<% content_for :page_title do %> Audit Trail <% end %>

<%= javascript_pack_tag 'audit_trail/index' %>

<% first_level_breadcrumb (:audit_trail) %>

<div class="row">
	<%= render layout: "shared/headers/header_generic", :locals => { badge: "A", header_title: "",
		main_text: "Audit Trail", sub_texts: "View, search and export the User Audit Trail." } do %>

    <div class="actions-wrap">
      <%= render partial: "shared/buttons/ico_btn_secondary", :locals => {link_path: export_csv_audit_trail_index_path, id: "export-csv-button",
        icon: "icon-document", btn_text: "Export CSV", dt_toggle: "", disabled: false } %>
    </div>


	<% end %>
</div>

<div class="row">

	<div class="col-md-12 card wide">
		<div class="card-header">Audit Trail</div>
    <div class="card-content table-cardstyle all-columns">

	    <%= form_for AuditTrail.new, :url => search_audit_trail_index_path do |f| %>
        <div class="text-centered">

          <div class="form-wrap hor">
    				<div class="form-group">
    				    <%= f.label :user, "User", class: "font-light text-small" %>
    				    <%= f.select(:user, options_for_select(@users.map{ |u| [u.email, u.email]}, @defaults[:user]) ) %>
    				</div>
    				<div class="form-group">
    				    <%= f.label :owner, "Owner", class: "font-light text-small" %>
    				    <%= f.select(:owner, options_for_select(@owners.map{ |u| [u.short_name, u.short_name]}, @defaults[:owner]) ) %>
    				</div>
    				<div class="form-group">
    				    <%= f.label :identifier, "Identifier", class: "font-light text-small"  %>
    				    <%= f.text_field :identifier %>
    				</div>
    				<div class="form-group">
    				    <%= f.label :event, "Event", class: "font-light text-small" %>
    				    <%= f.select(:event, options_for_select(@events.map{ |key, u| [AuditTrail.event_to_s(u), u]}, @defaults[:event]) ) %>
    				</div>
          </div>

    			<%= f.submit "Apply Filter", class: "btn medium light" %>
        </div>
  		<% end %>

  		<table id="main" class="table table-striped table-bordered table-condensed">
  		  	<thead>
  				<tr>
  			  		<th>Date Time</th>
  			    	<th>User</th>
  			    	<th>Owner</th>
  			    	<th>Identifier</th>
  			    	<th>Version</th>
  			    	<th>Event</th>
  			    	<th>Details</th>
  			  	</tr>
  			</thead>
  			<tbody>
  				<% @items.each do |item| %>
  				  	<tr>
  				    	<td><%= Timestamp.new(item.date_time).to_audit_datetime %></td>
  					    <td><%= item.user %></td>
  					    <td><%= item.owner %></td>
  					    <td><%= item.identifier %></td>
  					    <td><%= item.version %></td>
  					    <td><%= item.event_to_s %></td>
  					    <td><%= item.description %></td>
  			  		</tr>
  				<% end %>
  			</tbody>
  		</table>

    </div>
	</div>

</div>
