<%= javascript_tag 'setPageTitle("Audit Trail")' %>
<%= javascript_include_tag 'standard_datatable' %>
<% first_level_breadcrumb (id_to_type('audit_trail')) %>
<div id="datatables_order">
  <!-- Datatables column order option-->
  <%= javascript_tag "var dtMainOrderUpdate = #{column_order(0, :desc)};" %>
</div>
<div class="row">
  <div class="col-md-12 card narrow">
    <div class="card-header">Filter Audit Trail Data</div>
    <div class="card-content">
			<%= form_for AuditTrail.new, :url => search_audit_trail_index_path do |f| %>
        <div class="form-wrap hor">
  				<div class="form-group">
  				    <%= f.label :user, "User:", class: "font-light" %><br />
  				    <%= f.select(:user, options_for_select(@users.map{ |u| [u.email, u.email]}, @defaults[:user]), {}, {:class => 'form-control'}) %>
  				</div>
  				<div class="form-group">
  				    <%= f.label :owner, "Owner:", class: "font-light"  %><br />
  				    <%= f.select(:owner, options_for_select(@owners.map{ |u| [u.short_name, u.short_name]}, @defaults[:owner]), {}, {:class => 'form-control'}) %>
  				</div>
  				<div class="form-group">
  				    <%= f.label :identifier, "Identifier:", class: "font-light"  %><br />
  				    <%= f.text_field :identifier %>
  				</div>
  				<div class="form-group">
  				    <%= f.label :event, "Event:", class: "font-light"  %><br />
  				    <%= f.select(:event, options_for_select(@events.map{ |key, u| [AuditTrail.event_to_s(u), u]}, @defaults[:event]), {}, {:class => 'form-control'}) %>
  				</div>
        </div>
				<center><%= f.submit "Filter results", class: "btn medium" %></center>
			<% end %>
		</div>
	</div>
	<div class="col-md-12 card wide">
		<div class="card-header">Audit Trail</div>
    <div class="card-content table-cardstyle all-columns">
		<table id="main" class="table table-striped table-bordered table-condensed">
		  	<thead>
				<tr>
			  		<th>Date Time</th>
			    	<th>User</th>
			    	<th>Owner</th>
			    	<th>Identifier</th>
			    	<th>Version</th>
			    	<th>Event</th>
			    	<th>Details</th>
			  	</tr>
			</thead>
			<tbody>
				<% @items.each do |item| %>
				  	<tr>
				    	<td><%= Timestamp.new(item.date_time).to_datetime %></td>
					    <td><%= item.user %></td>
					    <td><%= item.owner %></td>
					    <td><%= item.identifier %></td>
					    <td><%= item.version %></td>
					    <td><%= item.event_to_s %></td>
					    <td><%= item.description %></td>
			  		</tr>
				<% end %>
			</tbody>
		</table>
		<%= link_to "Export CSV", export_csv_audit_trail_index_path, :class => "btn medium" %>
    </div>
	</div>
</div>
