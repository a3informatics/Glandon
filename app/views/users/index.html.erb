<% content_for :page_title do %> Manage Users <% end %>

<%= javascript_include_tag 'standard_datatable' %>
<% first_level_breadcrumb (:users) %>
<div class="card col-md-12">
	<div class="card-header">All user accounts</div>
	<div class="card-content">
		<table id="main" class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
		    	<th>User email</th>
		    	<th>Roles</th>
		    	<th>Login Count</th>
          <th>Last Login</th>
          <th></th>
		    	<th></th>
          <th></th>
          <th></th>
		  	</tr>
			</thead>
			<tbody>
				<% @users.each do |user| %>
				  <% last_si = user.last_sign_in_at %>
        	<tr>
				    	<td><%= "#{user.email}" %></td>
				    	<td><%= "#{user.role_list_stripped}" %></td>
              <td><%= "#{user.sign_in_count}" %></td>
              <td><%= last_si.nil? ? "Not logged in yet!" : "#{last_si.strftime("%F")}, #{time_ago_in_words(last_si.strftime("%F"))}" %></td>
				    	<td style="text-align: center;"><%= link_to "Edit", edit_user_path(user), :class => "btn medium" %></td>
				    	<td style="text-align: center;">
				    		<% if @current_user.id != user.id %>
                  <%= link_to "Lock", lock_user_path(user), method: :put, :class => "btn medium " + (user.is_active? ? "": "disabled" ) %>
				    		<% end %>
				    	</td>
              <td style="text-align: center;">
                <% if @current_user.id != user.id %>
                  <%= link_to "Unlock", unlock_user_path(user), method: :put, :class => "btn medium " + ( user.is_active? ? "disabled": "" ) %>
                <% end %>
              </td>
              <td style="text-align: center;">
                <% if @current_user.id != user.id %>
                  <%= link_to "Delete", user_path(user), :class => "btn medium red", method: :delete, data: { confirm: "Are you sure?" } %>
                <% end %>
              </td>
				  	</tr>
				<% end %>
			</tbody>
		</table>
		<%= render partial: "shared/buttons/ico_btn_secondary_v2", :locals => {link_path: new_user_path, id: "new_user_btn",
			icon: "icon-plus", btn_color: "green", btn_text: "New", dt_toggle: "", disabled: false } %>
	</div>
</div>
