<%= javascript_tag 'setPageTitle("Edit Locks")' %>
<%= javascript_include_tag 'standard_datatable' %>
<% first_level_breadcrumb (:tokens) %>
<h3>Index: Edit Locks</h3>
<div class="row">
	<div class="col-md-12 card wide">
		<div class="card-header">
			Edit Locks (Tokens)
		</div>
		<div class="card-content table-cardstyle">
			<h4><span class="icon-lock text-prim-light"></span> Active Edit Locks:</h4>
			<br/>
			<table id="main" class="table table-striped table-bordered table-condensed">
					<thead>
					<tr>
							<th>Locked At</th>
							<th>Time remaining</th>
							<th>Item URI</th>
							<th>Info</th>
							<th>Who</th>
							<th>Refresh count</th>
							<th class="fit"></th>
						</tr>
				</thead>
				<tbody>
						<% @tokens.each do |token| %>
							<tr>
								<td><%= token.locked_at %></td>
								<td><%= Time.at(@timeout - (Time.now - token.locked_at).to_i.abs).utc.strftime "%M:%S" %></td>
								<td><%= token.item_uri %></td>
								<td><%= token.item_info %></td>
								<td><a class="icon-users text-link" href="<%=user_path(token.user_id)%>" target="_blank"></a></td>
								<td><%= token.refresh_count %></td>
								<td><%= link_to "Release", release_token_path(token.id), method: :post, data: { confirm: "Are you sure?" }, :class => "btn medium red" %></td>
							</tr>
						<% end %>
				</tbody>
			</table>
		</div>
	</div>
</div>
