<%= javascript_tag 'setPageTitle("Import Status")' %>
<% first_level_breadcrumb (:imports) %>
<%# javascript_include_tag 'background_index'%>
<%= javascript_include_tag 'standard_datatable' %>

<div class="row">
	<%= render layout: "shared/simple_header_card_general", :locals => {badge: "icon-import", header_title: "",
		main_text: "Import Centre", sub_texts: "Showing import details." } do %>

			<%= render partial: "shared/buttons/ico_btn_secondary", :locals => {link_path: imports_path, id: "close",
  			icon: "icon-long-arrow", btn_text: "Return", dt_toggle: "", disabled: false } %>

	<% end %>
</div>

<div class="row">
  <div class="col-md-12 card wide">
    <div class="card-header">Import Status</div>
    <div class="card-content">
      <% if @import.complete %>
        <div class = "sub-card-wrap">
        <div class="sub-card" style="width: 35%;">
          <div class="sub-card-header">Details</div>
          <div class="sub-card-content">
            <table class="table table-condensed">
              <tbody>
                <tr>
                  <td><strong>Description:</strong></td>
                  <td><%= @job.description %></td>
                </tr>
                <tr>
                  <td><strong>Identifier:</strong></td>
                  <td><%= @import[:identifier] %></td>
                </tr>
                <tr>
                  <td><strong>Owner:</strong></td>
                  <td><%= @import.owner %></td>
                </tr>
                <tr>
                  <td><strong>Success:</strong></td>
                  <%= true_false_cell(@import.success, :left) %>
                </tr>
                <tr>
                  <td><strong>Started At:</strong></td>
                  <td><%= Timestamp.new(@job.started).to_datetime %></td>
                </tr>
              </tbody>
            </table>
            <% if @import.success %>
              <div class="alert alert-success">No errors were detected with the import.</div>
              <% if @import.auto_load %>
                <%= link_to "Go to history", @import.success_path, :class => "btn medium light" %>
              <% else %>
                <div class="alert alert-warning">Auto load was not set so the item was not imported.</div>
              <% end %>
            <% else %>
              <div class="alert alert-danger">Errors were detected during the processing of the import file. See the error table.</div>
            <% end %>
          </div>
        </div>
        <% else %>
        <div class="sub-card" style="width: 60%;">
          <div class="sub-card-header">Background Job</div>
          <div class="sub-card-content table-cardstyle all-columns">
            <center><img src="<%= asset_path('loading.gif') %>" width="50px;"></center>
            <table class="table table-condensed">
              <tbody>
                <tr>
                  <td><strong>Description:</strong></td>
                  <td><%= @job.description %></td>
                </tr>
                <tr>
                  <td><strong>Status:</strong></td>
                  <td><%= @job.status %></td>
                </tr>
                <tr>
                  <td><strong>Started At:</strong></td>
                  <td><%= Timestamp.new(@job.started).to_datetime %></td>
                </tr>
                <tr>
                  <td><strong>Percentage:</strong></td>
                  <td><%= @job.percentage %></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      <% end %>
      <% if @job.complete %>
        <% if !@import.success %>
          <div class="sub-card red" style="width: 60%;">
            <div class="sub-card-header">Errors</div>
            <div class="sub-card-content table-cardstyle all-columns">
              <table id="main" class="table table-striped table-bordered table-condensed">
                <thead>
                  <th class="fit"></th>
                  <th>Error</th>
                </thead>
                <tbody>
                  <% @errors.each_with_index do |error, index| %>
                    <tr>
                      <td><%= index + 1 %></td>
                      <td><%= error %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        <% end %>
    <% end %>
  </div>
</div>
